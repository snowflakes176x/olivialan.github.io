var PList = [{id:"P0",name:"曾真",photo:"",information:""},
             {id:"P1",name:"陈国兴",photo:"",information:""},
             {id:"P2",name:"陈国雄",photo:"",information:""},
             {id:"P4",name:"陈建煌",photo:"",information:""},
             {id:"P5",name:"陈建新",photo:"",information:""},
             {id:"P6",name:"陈金秀",photo:"",information:""},
             {id:"P7",name:"陈金章",photo:"",information:""},
             {id:"P9",name:"林国良",photo:"",information:""},
             {id:"P10",name:"林建芳",photo:"",information:""},
             {id:"P11",name:"林明杰",photo:"",information:""},
             {id:"P12",name:"林明雄",photo:"",information:""},
             {id:"P13",name:"林新疆",photo:"",information:""},
             {id:"P14",name:"林玉国",photo:"",information:""},
             {id:"P15",name:"林玉明",photo:"",information:""},
             {id:"P16",name:"林玉盛",photo:"",information:""},
             {id:"P17",name:"林志程",photo:"",information:""},
             {id:"P18",name:"林志通",photo:"",information:""},
             {id:"P19",name:"林志忠",photo:"",information:""},
             {id:"P20",name:"林宗金",photo:"",information:""},
             {id:"P21",name:"王晓泸",photo:"",information:""},
             {id:"P22",name:"翁国亮",photo:"",information:""},
             {id:"P23",name:"翁金栋",photo:"",information:""},
             {id:"P24",name:"吴亚平",photo:"",information:""},
             {id:"P25",name:"詹国太",photo:"",information:""},
             {id:"P26",name:"詹妍",photo:"",information:""}
             ];
var CList = [
             {id:"C1",name:"杭州天目山医院",m:"B",information:""},
             {id:"C3",name:"昆山虹桥医院",m:"B",information:""},
             {id:"C4",name:"南昌曙光手足外科医院",m:"B",information:""},
             {id:"C5",name:"温州建国医院",m:"B",information:""},
             {id:"C6",name:"杭州建国医院",m:"B",information:""},
             {id:"C7",name:"上海健桥医院",m:"B",information:""},
            
             {id:"C10",name:"北京前海股骨头医院",m:"B",information:""},
             {id:"C11",name:"济南华夏医院",m:"B",information:""},
             {id:"C12",name:"内蒙古天骄医院",m:"B",information:""},
             {id:"C13",name:"济南乳腺医院",m:"B",information:""},
             {id:"C14",name:"泉州坤如玛丽医院",m:"B",information:""},
             {id:"C15",name:"上海华美美莱整形医院",m:"B",information:""},
             {id:"C16",name:"济南美莱整形医院",m:"B",information:""},
             {id:"C17",name:"南京阳光肿瘤医院",m:"B",information:""},
             {id:"C19",name:"长沙仁爱医院",m:"B",information:""},
             {id:"C20",name:"福州福兴妇产医院",m:"B",information:""},
             {id:"C21",name:"无锡虹桥医院",m:"B",information:""},
             {id:"C22",name:"南京建国男科医院",m:"B",information:""},
             {id:"C23",name:"宿迁市妇产医院",m:"B",information:""},
             {id:"C24",name:"北京年轮中医骨科医院",m:"B",information:""},
             {id:"C25",name:"长沙恒生手外科医院",m:"B",information:""},
             {id:"C26",name:"长沙南方骨外科医院",m:"B",information:""},
             {id:"C27",name:"长沙年轮骨科医院",m:"B",information:""},
             {id:"C28",name:"长沙现代女子医院",m:"B",information:""},
             {id:"C29",name:"南通长城医院",m:"B",information:""},
             {id:"C30",name:"南通和美家妇产科医院",m:"B",information:""},
             {id:"C31",name:"福州誉盛医院",m:"B",information:""},

             {id:"C33",name:"重庆涪陵和美妇产医院",m:"B",information:""},
             {id:"C39",name:"深圳和美妇儿科医院",m:"B",information:""},
             {id:"C46",name:"上海仁爱医院",m:"B",information:""},
             {id:"C47",name:"上海天大医疗美容医院",m:"B",information:""},
             {id:"C48",name:"上海沪申五官科医院",m:"B",information:""},
             {id:"C49",name:"深圳博爱医院",m:"B",information:""},
             {id:"C50",name:"深圳阳光医院",m:"B",information:""},
             {id:"C51",name:"湘潭阳光眼科中心",m:"B",information:""},
             {id:"C52",name:"深圳建国泌尿外科医院",m:"B",information:""},
             {id:"C53",name:"上海新虹桥医院",m:"B",information:""},
             {id:"C57",name:"上海美迪亚医院投资集团有限公司",m:"A",information:""},
             {id:"C58",name:"浙江美迪亚医院投资管理有限公司",m:"A",information:""},
             {id:"C59",name:"北京远时华夏投资有限公司",m:"A",information:""},
             {id:"C60",name:"华夏时代投资有限公司",m:"A",information:""},
             {id:"C61",name:"美莱医学美容医院有限公司",m:"A",information:""},
             {id:"C62",name:"上海美莱投资管理有限公司",m:"A",information:""},
             {id:"C63",name:"上海复以创业投资有限公司",m:"A",information:""},
             {id:"C64",name:"长沙年轮骨科医院有限公司",m:"A",information:""},
             {id:"C65",name:"湖南年轮骨科医院投资管理有限公司",m:"A",information:""},
             {id:"C66",name:"和美医疗集团",m:"A",information:""},
             {id:"C67",name:"北京合安达管理咨询有限公司",m:"A",information:""},
             {id:"C68",name:"贵阳和美妇产医院有限公司",m:"A",information:""},
             {id:"C69",name:"广东博爱医疗集团有限公司",m:"A",information:""},
             {id:"C70",name:"广东圣丹福医疗管理有限公司",m:"A",information:""},
             {id:"C71",name:"深圳市博爱投资管理有限公司",m:"A",information:""},
             {id:"C72",name:"上海仁爱投资管理有限公司",m:"A",information:""},
             {id:"C73",name:"圣丹福国际医疗(香港)有限公司",m:"A",information:""},
             {id:"C74",name:"博爱(中国)企业集团",m:"A",information:""},
             {id:"C75",name:"深圳春天医美集团股份有限公司",m:"A",information:""},
             {id:"C43",name:"广州现代医院",m:"B",information:""},
             ];

var CCList = [ {
	c1 : "C64",
	to : ">",
	c2 : "C65",
	m : "B"
},{
	c1 : "C67",
	to : ">",
	c2 : "C66",
	m : "B"
},{
	c1 : "C68",
	to : ">",
	c2 : "C67",
	m : "B"
},{
	c1 : "C70",
	to : ">",
	c2 : "C69",
	m : "B"
},{
	c1 : "C72",
	to : ">",
	c2 : "C71",
	m : "B"
},{
	c1 : "C73",
	to : ">",
	c2 : "C74",
	m : "B"
},{
	c1 : "C73",
	to : "=",
	c2 : "C43",
	m : "A"
},{
	c1 : "C25",
	to : "=",
	c2 : "C65",
	m : "A"
}];
var CPList = [
              {c:"C1",to:"=",p:"P0",m:"A"},
              {c:"C3",to:"=",p:"P1",m:"A"},
              {c:"C4",to:"=",p:"P1",m:"A"},
              {c:"C5",to:"=",p:"P1",m:"A"},
              {c:"C6",to:"=",p:"P2",m:"A"},
              {c:"C1",to:"=",p:"P2",m:"A"},
              {c:"C7",to:"=",p:"P2",m:"A"},
              {c:"C10",to:"=",p:"P4",m:"A"},
              {c:"C11",to:"=",p:"P4",m:"A"},
              {c:"C12",to:"=",p:"P4",m:"A"},
              {c:"C13",to:"=",p:"P5",m:"A"},
              {c:"C14",to:"=",p:"P5",m:"A"},
              {c:"C15",to:"=",p:"P6",m:"A"},
              {c:"C16",to:"=",p:"P6",m:"A"},
              {c:"C17",to:"=",p:"P7",m:"A"},
              {c:"C7",to:"=",p:"P7",m:"A"},
              {c:"C19",to:"=",p:"P10",m:"A"},
              {c:"C20",to:"=",p:"P10",m:"A"},
              {c:"C21",to:"=",p:"P11",m:"A"},
              {c:"C22",to:"=",p:"P12",m:"A"},
              {c:"C23",to:"=",p:"P12",m:"A"},
              {c:"C24",to:"=",p:"P13",m:"A"},
              {c:"C25",to:"=",p:"P13",m:"A"},
              {c:"C26",to:"=",p:"P13",m:"A"},
              {c:"C27",to:"=",p:"P13",m:"A"},
              {c:"C28",to:"=",p:"P13",m:"A"},
              {c:"C28",to:"=",p:"P14",m:"A"},
              {c:"C29",to:"=",p:"P14",m:"A"},
              {c:"C30",to:"=",p:"P14",m:"A"},
              {c:"C31",to:"=",p:"P14",m:"A"},
              {c:"C33",to:"=",p:"P15",m:"A"},
              {c:"C39",to:"=",p:"P15",m:"A"},
              {c:"C20",to:"=",p:"P16",m:"A"},
              {c:"C31",to:"=",p:"P16",m:"A"},
              {c:"C29",to:"=",p:"P16",m:"A"},
              {c:"C46",to:"=",p:"P17",m:"A"},
              {c:"C52",to:"=",p:"P18",m:"A"},
              {c:"C39",to:"=",p:"P18",m:"A"},
              {c:"C46",to:"=",p:"P19",m:"A"},
              {c:"C47",to:"=",p:"P19",m:"A"},
              {c:"C48",to:"=",p:"P19",m:"A"},
              {c:"C49",to:"=",p:"P19",m:"A"},
              {c:"C23",to:"=",p:"P20",m:"A"},
              {c:"C50",to:"=",p:"P21",m:"A"},
              {c:"C51",to:"=",p:"P21",m:"A"},
              {c:"C53",to:"=",p:"P23",m:"A"},
              {c:"C33",to:"=",p:"P24",m:"A"},
              {c:"C24",to:"=",p:"P25",m:"A"},
              {c:"C57",to:"=",p:"P1",m:"A"},
              {c:"C57",to:"=",p:"P26",m:"A"},
              {c:"C58",to:"=",p:"P2",m:"A"},
              {c:"C59",to:"=",p:"P4",m:"A"},
              {c:"C60",to:"=",p:"P4",m:"A"},
              {c:"C61",to:"=",p:"P6",m:"A"},
              {c:"C62",to:"=",p:"P6",m:"A"},
              {c:"C63",to:"=",p:"P12",m:"A"},
              {c:"C64",to:"=",p:"P13",m:"A"},
              {c:"C65",to:"=",p:"P13",m:"A"},
              {c:"C66",to:"=",p:"P15",m:"A"},
              {c:"C69",to:"=",p:"P17",m:"A"},
              {c:"C70",to:"=",p:"P17",m:"A"},
              {c:"C71",to:"=",p:"P19",m:"A"},
              {c:"C73",to:"=",p:"P17",m:"A"},
              {c:"C74",to:"=",p:"P19",m:"A"},
              {c:"C75",to:"=",p:"P21",m:"A"},
              {c:"C43",to:"=",p:"P17",m:"A"},
              ];



var PPList = [{
	p1 : "P1",
	to : "=",
	p2 : "P2",
	m : "A"
},{
	p1 : "P6",
	to : "=",
	p2 : "P5",
	m : "A"
},{
	p1 : "P6",
	to : "=",
	p2 : "P7",
	m : "A"
},{
	p1 : "P6",
	to : "=",
	p2 : "P1",
	m : "A"
},{
	p1 : "P7",
	to : "=",
	p2 : "P1",
	m : "A"
},{
	p1 : "P17",
	to : "=",
	p2 : "P19",
	m : "A"
},{
	p1 : "P1",
	to : ">",
	p2 : "P26",
	m : "B"
}];
var PS = ["P0",
  		"P26","P1","P2","P6", 
		"P7", "P4", "P5",  "P9","P10","P11", "P12","P13", "P14","P15","P16","P18","P17","P19","P20", "P21",
		"P22", "P23","P24","P25"
		];

var CS = ["C30","C31","C33","C39",
 
           "C14","C15","C16","C17","C13","C28",
           "C1",
           "C3","C4", "C7","C22","C27","C10",
           "C26","C5","C6","C11","C12", 
           "C19",
           "C20","C21","C23","C24","C29","C46","C47","C48","C49",
           "C50","C51","C52","C53","C25","C43","TOP_SPACE","C73","C74","C65","C64",
           
           "C57","C58","C59","C60","C61","C62","C63","C66",
           "C67","C68","C69","C70","C71","C72","C75"
          ];
var BGColor = "#252525";
var PPMColor = [ {
	"m" : "A",
	"name" : "直系亲属",
	"color" : "#fc3c3c"
}, {
	"m" : "B",
	"name" : "股东",
	"color" : "#a43dcc"
}/*, {
	"m" : "C",
	"name" : "师徒",
	"color" : "#f1882d"
}*/ ];
var CPColor = "#4d4d4d";
var WeakenColor = "#666";
var CCMColor = [ {
	"m" : "A",
	"name" : "投资",
	"color" : "#ffff99"
},{
	"m" : "B",
	"name" : "持股",
	"color" : "#D0D0D0"
}, {
	"m" : "C",
	"name" : "",
	"color" : "#6856de"
} ];
var CMColor = [ {
	"m" : "B",
	"name" : "莆田系医院",
	"color" : "#93bbd5"
}, {
	"m" : "A",
	"name" : "相关企业",
	"color" : "#cbcacc"
}, {
	"m" : "C",
	"name" : "",
	"color" : "#45a4cc"
}, {
	"m" : "D",
	"name" : "",
	"color" : "#45a4cc"
} ];
document
.write("<div style='background-color:"
		+ BGColor
		+ ";width:100%;'><div id='mainDiv'><canvas id='mainCanvas'></canvas></div></div>");
var WIDTH = 1240;
var HEIGHT = 750;
var time = 0;
var mouseX = 0;
var mouseY = 0;
var stagePressed = true;
var clickObject = null;
var startText = "【财新网 caixin.com】/";
$(document)
.ready(
function() {
	$("#mainDiv").css({
		"width" : "100%"
	});
	$("#mainCanvas").attr("width", WIDTH);
	$("#mainCanvas").attr("height", HEIGHT);
	$("#mainCanvas").css({
		"display" : "block",
		"margin-left" : "auto",
		"margin-right" : "auto",
		"background-color" : BGColor
	});
	var canvas = document.getElementById("mainCanvas");
	var main = canvas.getContext("2d");
	canvas.addEventListener("mousemove", mousemove, false);
	canvas.addEventListener("mousedown", mousedown, false);
	function mousemove(e) {
		mouseX = e.clientX + $(window).scrollLeft()
				- $(canvas).offset().left;
		mouseY = e.clientY + $(window).scrollTop()
				- $(canvas).offset().top
	}
	function mousedown(e) {
		if (caixin.checkMouse()) {
			caixin.click()
		}
		for ( var i = 0; i < PArray.length; i++) {
			if (PArray[i].checkMouse()) {
				PArray[i].click();
				stagePressed = false;
				return
			}
		}
		for ( var i = 0; i < CArray.length; i++) {
			if (CArray[i].checkMouse()) {
				CArray[i].click();
				stagePressed = false;
				return
			}
		}
		stagePressed = true;
		clickObject = null
	}
	var hasPhoto = false;
	var photo = new Image();
	photo.src = "";
	photo.onload = function() {
		hasPhoto = true
	};
	photo.onerror = function() {
		hasPhoto = false
	};
	var INFO = function() {
		this.x = 930;
		this.y = 30;
		this.name = "";
		this.text = "";
		this.offsetX = 90;
		this.offsetY = 0;
		this.minWidth = 190;
		this.maxWidth = this.minWidth + this.offsetX;
		this.top = 40;
		this.bottom = 230;
		this.startY = 0;
		this.h = 0
	};
	INFO.prototype.display = function() {
		main.globalAlpha = 1;
		main.fillStyle = "#fff";
		main.font = "13px 'Microsoft YaHei', 微软雅黑";
		if (hasPhoto) {
			this.h = multiLineText(this.text, this.x
					+ this.offsetX, this.y + 60 + this.offsetY
					+ this.startY, this.minWidth)
		} else {
			this.h = multiLineText(this.text, this.x, this.y
					+ 60 + this.offsetY + this.startY,
					this.maxWidth)
		}
		main.fillStyle = BGColor;
		main.fillRect(this.x, 0, this.maxWidth + 30, this.y
				+ this.top);
		main.fillRect(this.x, this.y + this.bottom,
				this.maxWidth + 30, 800);
		if (this.h > this.bottom - this.top) {
			this.startY = (this.bottom - this.top) * .5;
			main.strokeStyle = "#444";
			main.lineWidth = 1;
			main.beginPath();
			main.moveTo(this.x + this.offsetX, this.y + 30);
			if (hasPhoto) {
				main.lineTo(this.x + this.offsetX
						+ this.minWidth, this.y + 30)
			} else {
				main.lineTo(this.x + this.offsetX
						+ this.maxWidth, this.y + 30)
			}
			main.stroke();
			main.strokeStyle = "#88c7e2";
			main.lineWidth = 1;
			main.beginPath();
			main.moveTo(this.x + this.offsetX, this.y + 30);
			if (hasPhoto) {
				main
						.lineTo(
								this.x
										+ this.offsetX
										+ Math
												.min(
														this.minWidth
																* -this.offsetY
																/ (this.h
																		- (this.bottom - this.top) + this.startY),
														this.minWidth),
								this.y + 30)
			} else {
				main
						.lineTo(
								this.x
										+ this.offsetX
										+ Math
												.min(
														this.maxWidth
																* -this.offsetY
																/ (this.h
																		- (this.bottom - this.top) + this.startY),
														this.maxWidth),
								this.y + 30)
			}
			main.stroke();
			this.offsetY -= .8;
			if (this.offsetY + this.startY <= -this.h) {
				this.offsetY = 0;
				this.count = 0
			}
		} else {
			this.startY = 0
		}
		main.fillStyle = "#fff";
		main.font = "16px 'Microsoft YaHei', 微软雅黑";
		main.fillText(this.name, this.x + this.offsetX,
				this.y + 20);
		if (hasPhoto) {
			main.drawImage(photo, this.x, this.y, 80, 80);
			this.offsetX = 90
		} else {
			this.offsetX = 0
		}
	};
	
	var Caixin = function() {
		this.x;
		this.y
	};
	Caixin.prototype.checkMouse = function() {
		return mouseX > this.x && mouseX < this.x + 100
				&& mouseY > this.y && mouseY < this.y + 100
	};
	var caixin = new Caixin();
	var LogoAndLegend = function() {
		this.logoX = 10;
		this.PPMLegendX = 20;
		this.CCMLegendX = 250;
		this.CMLegendX = 450;
		this.LegendY = 710;
		this.y = 20;
	};
	LogoAndLegend.prototype.display = function() {
		PPMLegend(this.PPMLegendX, this.y + this.LegendY, 40);
		CCMLegend(this.CCMLegendX, this.y + this.LegendY, 40);
		CMLegend(this.CMLegendX, this.y + this.LegendY, 40);
	};
	var G = function(name) {
		this.name = name;
		this.alpha = 1;
		this.weaken = false
	};
	G.prototype.display = function() {
		if (this.weaken) {
			this.alpha = .5
		} else {
			this.alpha = 1
		}
		main.fillStyle = "#c7b299";
		main.globalAlpha = this.alpha;
		main.font = "14px 'Microsoft YaHei', 微软雅黑";
		verticalText(this.name, this.x, this.y + 8, 16)
	};
	var P = function(id, name, photo, information) {
		this.id = id;
		this.name = name;
		this.photo = photo;
		this.information = startText + information;
		this.init()
	};
	P.prototype.init = function() {
		this.over = false;
		this.font = "14px 'Microsoft YaHei', 微软雅黑";
		this.lineHeight = 16;
		this.alpha = 1;
		this.color = "#fff";
		this.weaken = false
	};
	P.prototype.display = function() {
		if (this.weaken) {
			this.color = WeakenColor
		} else {
			this.color = "#fff"
		}
		main.globalAlpha = this.alpha;
		main.fillStyle = this.color;
		main.font = this.font;
		verticalText(this.name, this.x, this.y + 8,
				this.lineHeight);
		if (this.number) {
			this.subscript(this.number)
		}
	};
	P.prototype.subscript = function(number) {
		main.fillStyle = "#fff";
		main.beginPath();
		main.arc(this.x, this.y + 72, 7, 0, 2 * Math.PI);
		main.fill();
		main.font = "12px 'Microsoft YaHei', 微软雅黑";
		main.fillStyle = "#000";
		main.fillText(number, this.x - 3, this.y + 76)
	};
	P.prototype.checkMouse = function() {
		return mouseX > this.x - 12 && mouseX < this.x + 12
				&& mouseY > this.y && mouseY < this.y + 100
	};
	P.prototype.checkMouseEvent = function() {
		if (this.checkMouse()) {
			if (!this.over) {
				this.over = true;
				this.mosueOver()
			}
			this.weaken = false
		} else {
			if (this.over) {
				this.over = false;
				this.mosueOut()
			}
		}
	};
	P.prototype.mosueOver = function() {
		this.font = "15px 'Microsoft YaHei', 微软雅黑";
		this.lineHeight = 18;
		if (this.photo != "") {
			photo.src = "http://file.caixin.com/datanews/zhou/img/photo/"
					+ this.photo
		} else {
			hasPhoto = false
		}
		info.name = this.name;
		info.text = this.information;
		info.y = 40;
		info.offsetY = 0
	};
	P.prototype.mosueOut = function() {
		this.font = "14px 'Microsoft YaHei', 微软雅黑";
		this.lineHeight = 16
	};
	P.prototype.click = function() {
		clickObject = this
	};
	P.prototype.connectChildren = function() {
		for ( var i = 0; i < PPArray.length; i++) {
			if (PPArray[i].p1.id == this.id) {
				PPArray[i].display();
				PPArray[i].p1.weaken = false;
				PPArray[i].p2.weaken = false;
			}
		}
	};
	P.prototype.connectParent = function() {
		for ( var i = 0; i < PPArray.length; i++) {
			if (PPArray[i].p2.id == this.id) {
				PPArray[i].display();
				PPArray[i].p1.weaken = false;
				PPArray[i].p1.connectParent()
			}
		}
	};
	var C = function(id, name, m, information) {
		this.id = id;
		this.name = name;
		this.m = m;
		this.information = startText + information;
		this.init()
	};
	C.prototype.init = function() {
		this.over = false;
		this.font = "12px 'Microsoft YaHei', 微软雅黑";
		this.lineHeight = 16;
		this.color = getColorByCM(this.m);
		this.alpha = 1;
		this.weaken = false
	};
	C.prototype.display = function() {
		if (this.weaken) {
			this.color = WeakenColor
		} else {
			this.color = getColorByCM(this.m)
		}
		main.globalAlpha = this.alpha;
		main.fillStyle = this.color;
		main.font = this.font;
		verticalText(this.name, this.x, this.y + 8,
				this.lineHeight)
	};
	C.prototype.checkMouse = function() {
		return mouseX > this.x - 10 && mouseX < this.x + 10
				&& mouseY > this.y && mouseY < this.y + 200
	};
	C.prototype.checkMouseEvent = function() {
		if (this.checkMouse()) {
			if (!this.over) {
				this.over = true;
				this.mosueOver()
			}
			this.weaken = false;
			this.color = getColorByCM(this.m)
		} else {
			if (this.over) {
				this.over = false;
				this.mosueOut()
			}
		}
	};
	C.prototype.mosueOver = function() {
		this.font = "13px 'Microsoft YaHei', 微软雅黑";
		this.lineHeight = 18;
		hasPhoto = false;
		if (this.information != "") {
			if (this.name.charAt(0) == "/") {
				info.name = this.name.slice(1)
			} else {
				info.name = this.name
			}
			info.text = this.information;
			console.log(document.documentElement.clientHeight);
			if (document.documentElement.clientHeight < 600) {
				info.y = 190
			} else {
				info.y = 40
			}
		} else {
			info.name = "";
			info.text = ""
		}
		info.offsetY = 0
	};
	C.prototype.mosueOut = function() {
		this.font = "12px 'Microsoft YaHei', 微软雅黑";
		this.lineHeight = 16
	};
	C.prototype.click = function() {
		clickObject = this
	};
	C.prototype.connectChildren = function() {
		this.weaken = false;
		for ( var i = 0; i < CCArray.length; i++) {
			if (CCArray[i].c1.id == this.id) {
				CCArray[i].display();
				var c2 = getCByID(CCList[i].c2);
				c2.connectChildren();
			}
		}
	};
	C.prototype.connectParent = function() {
		this.weaken = false;
		for ( var i = 0; i < CCArray.length; i++) {
			if (CCArray[i].c2.id == this.id) {
				CCArray[i].display();
				var c1 = getCByID(CCList[i].c1);
				c1.connectParent();
				c1.connectP();
			}
		}
	};
	C.prototype.connectP = function() {
		this.weaken = false;
		for ( var i = 0; i < CPArray.length; i++) {
			if (CPArray[i].c.id == this.id) {
				CPArray[i].display();
				CPArray[i].p.weaken = false;
				CPArray[i].c.weaken = false;
				CPArray[i].p.connectParent();
			}
		}
	};
	var PP = function(p1, to, p2, m) {
		this.p1 = p1;
		this.to = to;
		this.p2 = p2;
		this.m = m;
		this.init()
	};
	PP.prototype.init = function() {
		this.x = (this.p1.x + this.p2.x) * .5;
		this.y = this.p1.y;
		this.r = Math.abs(this.p1.x - this.p2.x) * .5;
		this.color = getColorByPPM(this.m);
		this.xpath = new Array();
		this.ypath = new Array();
		this.pointList = [];
		this.n = 200;
		for ( var i = 0; i < this.n; i++) {
			if (this.p2.x - this.p1.x > 0) {
				this.xpath[i] = this.x
						+ Math.cos(-i % this.n / this.n
								* Math.PI) * this.r;
				this.ypath[i] = this.y
						+ Math.sin(-i % this.n / this.n
								* Math.PI) * this.r;
				this.pointList.push(this.xpath[i], this.ypath[i]);
			} else {
				this.xpath[i] = this.x
						+ Math.cos(-Math.PI + i % this.n
								/ this.n * Math.PI) * this.r;
				this.ypath[i] = this.y
						+ Math.sin(-Math.PI + i % this.n
								/ this.n * Math.PI) * this.r;
				this.pointList.push(this.xpath[i], this.ypath[i]);
			}
		}
	};
	PP.prototype.display = function() {
		
		
		main.globalAlpha = 1;
		main.strokeStyle = this.color;
		main.beginPath();
		main.arc(this.x, this.y, this.r, Math.PI, 0);
		main.stroke();
		if (this.to == ">") {
			var t = time % this.n;
			//main.fillStyle = "#fff";
			main.fillStyle = 'rgba(255,255,255,.9)';
			
			main.beginPath();
			main.arc(this.xpath[t], this.ypath[t], 2.5,0,
					Math.PI * 2, true);
			main.fill();					
		}
	};
	
	 
	
	
	var CC = function(c1, to, c2, m) {
		this.c1 = c1;
		this.to = to;
		this.c2 = c2;
		this.m = m;
		this.init()
	};
	CC.prototype.init = function() {
		this.x = (this.c1.x + this.c2.x) * .5;
		this.y = this.c1.y;
		this.r = Math.abs(this.c1.x - this.c2.x) * .5;
		this.color = getColorByCCM(this.m);
		this.xpath = new Array();
		this.ypath = new Array();
		this.n = 200;
		for ( var i = 0; i < this.n; i++) {
			if (this.c2.x - this.c1.x > 0) {
				this.xpath[i] = this.x
						+ Math.cos(-i % this.n / this.n
								* Math.PI) * this.r;
				this.ypath[i] = this.y
						+ Math.sin(-i % this.n / this.n
								* Math.PI) * this.r
			} else {
				this.xpath[i] = this.x
						+ Math.cos(-Math.PI + i % this.n
								/ this.n * Math.PI) * this.r;
				this.ypath[i] = this.y
						+ Math.sin(-Math.PI + i % this.n
								/ this.n * Math.PI) * this.r
			}
		}		
	};
	CC.prototype.display = function() {
		main.globalAlpha = 1;
		main.strokeStyle = this.color;
		
		/*if(this.m == "C"){
			this.c2.type = "arc";
		}else if(this.c2.m == "B"){
			this.c2.type = "line";
		}*/
		if (this.c2.type == "arc") {
			main.beginPath();
			main.arc(this.x, this.y, this.r, Math.PI, 0);
			main.stroke();
			if (this.to == ">") {
				var t = time % this.n;
				main.fillStyle = "#fff";
				main.beginPath();
				main.arc(this.xpath[t], this.ypath[t], 2.5,
						Math.PI * 2, 0);
				main.fill()
			}
		} else {
			main.globalAlpha = .5;
			main.strokeStyle = this.color;
			main.beginPath();
			main.moveTo(this.c1.x, this.c1.y + 210);
			main.lineTo(this.c2.x, this.c2.y);
			main.stroke();
			if (this.c1.y + this.c1.name.length * 18 + 10 < this.c1.y + 210) {
				main.beginPath();
				main.moveTo(this.c1.x, this.c1.y
						+ this.c1.name.length * 18 + 10);
				main.lineTo(this.c1.x, this.c1.y + 180);
				main.stroke()
			}
		}
	};
	var CP = function(c, to, p, m) {
		this.c = c;
		this.to = to;
		this.p = p;
		this.m = m;
		this.color = getColorByCCM(this.m)
	};
	CP.prototype.display = function() {
		if (clickObject != null) {
			main.globalAlpha = .5;
			main.strokeStyle = this.color
		} else {
			main.globalAlpha = 1;
			main.strokeStyle = CPColor
		}
		main.beginPath();
		main.moveTo(this.p.x, this.p.y + 72);
		main.lineTo(this.c.x, this.c.y);
		main.stroke()
	};
	var GArray = new Array();
	var PArray = new Array();
	var CArray = new Array();
	var PPArray = new Array();
	var CPArray = new Array();
	var CCArray = new Array();
	var logoAndLegend = new LogoAndLegend();
	var info = new INFO();
	for ( var i = 0; i < PS.length; i++) {
		var space = 20;
		var x = 20;
		var y = 100;
		if (PS[i] != "") {
			if (PS[i].charAt(0) == "G") {
				var g = new G(PS[i].slice(1));
				g.x = x + i * space;
				g.y = y;
				GArray.push(g)
			} else {
				var pData = getPDataByID(PS[i]);
				var p = new P(pData.id, pData.name,
						pData.photo, pData.information);
				p.x = x + 280 + i * 1.1 *space;
				p.y = y;
				PArray.push(p)
			}
		}
	}
	var space = 20;
	var x1 = 0;
	var x2 = 0;
	var y = 400;
	for ( var i = 0; i < CS.length; i++) {
		if (CS[i] != "TOP_SPACE" && CS[i] != "BOTTOM_SPACE") {
			var cData = getCDataByID(CS[i]);
			var c = new C(cData.id, cData.name, cData.m,
					cData.information);
			if (cData.m == "") {
				c.type = "line";					
				x2 += space;
				c.x = x2;
				c.y = y + 350;
			} else {
				c.type = "arc";
				x1 += space;
				c.x = x1;
				c.y = y;
			}
			CArray.push(c);
		} else {
			if (CS[i] == "TOP_SPACE") {
				x1 += space;
			} else {
				x2 += space;
			}
		}
	}
	function CtoPs(c) {
		for ( var i = 0; i < CPList.length; i++) {
			if (CPList[i].c == c) {
				return true
			}
		}
		return false
	}
	function CtoCs(c) {
		for ( var i = 0; i < CCList.length; i++) {
			if (CCList[i].c1 == c) {
				return true
			}
		}
		return false
	}
	for ( var i = 0; i < PPList.length; i++) {
		var p1 = getPByID(PPList[i].p1);
		var p2 = getPByID(PPList[i].p2);
		var pp = new PP(p1, PPList[i].to, p2, PPList[i].m);
		PPArray.push(pp)
	}
	for ( var i = 0; i < CPList.length; i++) {
		var c = getCByID(CPList[i].c);
		var p = getPByID(CPList[i].p);
		var cp = new CP(c, CPList[i].to, p, CPList[i].m);
		CPArray.push(cp)
	}
	for ( var i = 0; i < CCList.length; i++) {
		var c1 = getCByID(CCList[i].c1);
		var c2 = getCByID(CCList[i].c2);
		var cc = new CC(c1, CCList[i].to, c2, CCList[i].m);
		CCArray.push(cc)
	}
	window.requestAnimFrame = (function() {
		return window.requestAnimationFrame
				|| window.webkitRequestAnimationFrame
				|| window.mozRequestAnimationFrame
				|| window.oRequestAnimationFrame
				|| window.msRequestAnimationFrame
				|| function(callback) {
					window.setTimeout(callback, 1000 / 33)
				}
	})();
	(function draw() {
		requestAnimFrame(draw);
		main.clearRect(0, 0, canvas.width, canvas.height);
		main.lineWidth = 1;
		//info.display();
		logoAndLegend.display();
		for ( var i = 0; i < GArray.length; i++) {
			if (clickObject == null) {
				GArray[i].weaken = false
			} else {
				GArray[i].weaken = true
			}
			GArray[i].display()
		}
		for ( var i = 0; i < PArray.length; i++) {
			if (clickObject == null || clickObject == PArray[i]) {
				PArray[i].weaken = false
			} else {
				PArray[i].weaken = true
			}
			PArray[i].checkMouseEvent()
		}
		for ( var i = 0; i < CArray.length; i++) {
			if (clickObject == null || clickObject == CArray[i]) {
				CArray[i].weaken = false
			} else {
				CArray[i].weaken = true
			}
			CArray[i].checkMouseEvent()
		}
		for ( var i = 0; i < PPArray.length; i++) {
			if (clickObject == null
					|| PPArray[i].p1.id == clickObject.id
					|| PPArray[i].p2.id == clickObject.id) {
				PPArray[i].display();
				PPArray[i].p1.weaken = false;
				PPArray[i].p2.weaken = false;
			    /*if (clickObject != null
						&& PPArray[i].p1.id == clickObject.id) {
					PPArray[i].p1.connectParent()
				}
				if (clickObject != null
						&& PPArray[i].p2.id == clickObject.id) {
					PPArray[i].p2.connectParent()
				}*/
			}
		}
		for ( var i = 0; i < CPArray.length; i++) {
			if (clickObject == null
					|| CPArray[i].p.id == clickObject.id
					|| CPArray[i].c.id == clickObject.id) {
				CPArray[i].display();
				CPArray[i].p.weaken = false;
				CPArray[i].c.weaken = false;
				if (clickObject != null
						&& CPArray[i].p.id == clickObject.id) {
					CPArray[i].c.connectChildren();
					CPArray[i].c.connectParent();
				}
				if (clickObject != null
						&& CPArray[i].c.id == clickObject.id) {
					CPArray[i].p.connectParent();
					CPArray[i].p.connectChildren();
				}
			}
		}
		for ( var i = 0; i < CCArray.length; i++) {
			if (clickObject == null
					|| CCArray[i].c1.id == clickObject.id
					|| CCArray[i].c2.id == clickObject.id) {
				CCArray[i].c1.weaken = false;
				CCArray[i].display();
				if (clickObject != null
						&& CCArray[i].c1.id == clickObject.id) {
					var c1 = getCByID(CCList[i].c1);
					c1.connectChildren()
				}
				if (clickObject != null
						&& CCArray[i].c2.id == clickObject.id) {
					var c2 = getCByID(CCList[i].c2);
					c2.connectParent();
					c2.connectChildren()
				}
			}
		}
		for ( var i = 0; i < PArray.length; i++) {
			PArray[i].display()
		}
		for ( var i = 0; i < CArray.length; i++) {
			CArray[i].display()
		}
		time++
	})();
	function getPDataByID(id) {
		for ( var i = 0; i < PList.length; i++) {
			if (PList[i].id == id) {
				return PList[i]
			}
		}
	}
	function getPByID(id) {
		for ( var i = 0; i < PArray.length; i++) {
			if (PArray[i].id == id) {
				return PArray[i]
			}
		}
	}
	function getCDataByID(id) {
		for ( var i = 0; i < CList.length; i++) {
			if (CList[i].id == id) {
				return CList[i]
			}
		}
	}
	function getCByID(id) {
		for ( var i = 0; i < CArray.length; i++) {
			if (CArray[i].id == id) {
				return CArray[i]
			}
		}
	}
	function verticalText(string, x, y, h) {
		var vertical = true;
		main.save();
		main.translate(x, y);
		for ( var i = 0; i < string.length; i++) {
			if (string.charCodeAt(i) > 255) {
				main.translate(0, h);
				main
						.fillText(string.charAt(i),
								-main.measureText(string
										.charAt(i)).width / 2,
								0)
			} else {
				main.save();
				main.translate(-5, 6);
				main.rotate(Math.PI / 2);
				main.fillText(string.charAt(i), 0, 0);
				main.restore();
				main.translate(0, main.measureText(string
						.charAt(i)).width + 2)
			}
		}
		main.restore()
	}
	function multiLineText(string, x, y, w) {
		var tx = 28;
		var ty = 0;
		for ( var i = 0; i < string.length; i++) {
			var c = string.charAt(i);
			if (c != "/") {
				main.fillText(c, x + tx, y + ty);
				tx += main.measureText(c).width + 2;
				if (tx > w) {
					tx = 0;
					ty += 20
				}
			} else {
				tx = 28;
				ty += 40
			}
		}
		return ty + 20
	}
	function PPMLegend(x, y, space) {
		for ( var i = 0; i < PPMColor.length; i++) {
			main.globalAlpha = 1;
			main.fillStyle = PPMColor[i].color;
			main.fillRect(x - 8, y - 1, 16, 2);
			if (PPMColor[i].m != "A") {
				main.fillStyle = "#fff";
				main.beginPath();
				main.arc(x, y, 2.5, 0, Math.PI * 2);
				main.fill()
			}
			main.fillStyle = "#ccc";
			main.font = "12px 'Microsoft YaHei', 微软雅黑";
			main.fillText(PPMColor[i].name, x + 14, y + 4);
			x += main.measureText(PPMColor[i].name).width
					+ space
		}
	}
	function CCMLegend(x, y, space) {
		for ( var i = 0; i < CCMColor.length; i++) {
			if(CCMColor[i].name !=""){
				main.globalAlpha = 1;
				main.fillStyle = CCMColor[i].color;
				main.fillRect(x - 8, y - 1, 16, 2);
				
				if (CCMColor[i].m != "A") {
					main.fillStyle = "#fff";
					main.beginPath();
					main.arc(x, y, 2.5, 0, Math.PI * 2);
					main.fill()
				}
				
				/*main.fillStyle = "#fff";
				main.beginPath();
				main.arc(x, y, 2.5, 0, Math.PI * 2);
				main.fill();*/
				main.fillStyle = "#ccc";
				main.font = "12px 'Microsoft YaHei', 微软雅黑";
				main.fillText(CCMColor[i].name, x + 14, y + 4);
				x += main.measureText(CCMColor[i].name).width
						+ space;
			}
			
		}
	}
	function CMLegend(x, y, space) {
		for ( var i = 0; i < 2; i++) {
			main.globalAlpha = 1;
			main.fillStyle = CMColor[i].color;
			main.fillRect(x - 4, y - 4, 8, 8);
			main.fillStyle = "#ccc";
			main.font = "12px 'Microsoft YaHei', 微软雅黑";
			main.fillText(CMColor[i].name, x + 14, y + 4);
			x += main.measureText(CMColor[i].name).width
					+ space
		}
	}
	function getColorByPPM(m) {
		for ( var i = 0; i < PPMColor.length; i++) {
			if (PPMColor[i].m == m) {
				return PPMColor[i].color
			}
		}
	}
	function getColorByCCM(m) {
		for ( var i = 0; i < CCMColor.length; i++) {
			if (CCMColor[i].m == m) {
				return CCMColor[i].color
			}
		}
	}
	function getColorByCM(m) {
		for ( var i = 0; i < CMColor.length; i++) {
			if (CMColor[i].m == m) {
				return CMColor[i].color
			}
		}
	}
});